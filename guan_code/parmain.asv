%% parmain
clear
Tr_all=load('../data_train_true3.mat');%data_train_true2.mat');
Test_all=load('../data_train_test3.mat');
long =14;
num_all_X=long^2;
N = 0;
%% 求先验概率
[Cls,Pos ]=sort(Tr_all.train_label);
Px=tabulate(Cls)  
pw = Px(:,3)./100;
[Cls_test,Pos_test ]=sort(Test_all.train_label);%%测试集
Px_test=tabulate(Cls_test);
pw_test = Px_test(:,3)./100;
%% 对train数据进行排序
train_oder=Tr_all.train(Pos,:);%%将数据集按照0-9排序
test_order = Test_all.train(Pos_test,:);
flg=1;
flg_test=1;
samp_test =1000;
test = Test_all.train(1:samp_test,:);% 取前五个样本，1-3项特征 
test_true_lable = Test_all.train_label(1:samp_test);

for kk=1:10
Tra_cell{kk}=train_oder(flg:flg+Px(kk,2)-1,:);
w(:,:,kk) = Tra_cell{kk}(200:500,:);%%前30个样本，1-3项特征   %w = [样本数目，3维特征，10类分类]
Test_cell{kk}= test_order(flg_test:flg_test+Px_test(kk,2)-1,:);
Sum{kk} = sum(Tra_cell{kk});
flg = flg+Px(kk,2);
flg_test = flg_test+Px_test(kk,2);
% subplot(3,4,kk)
% hold on 
% mesh(reshape(Sum{kk},long,long));%%绘制特征提取图像
% title(['数字',num2str(kk-1,'%d'),'提取的特征']);
end


%% parzen main
h=[1, 4, 8, 16, 32, 64, 128, 256];
% i 为测试集个数

suc = [];
for c_h = 1:length(h)
    count=0;
for i=1:samp_test
    r=parzen(w,h(c_h),test(i,:));
    result=find(r==max(r));
    X=['点[',num2str(test(i,:)),']落在三个类别的概率分别为：',num2str(r)];
    Y=['因此，点[',num2str(test(i,:)),']落在第',num2str(result),'类,正确为第',num2str(test_true_lable(i)+1),'类'];
%     disp(X);disp(Y);disp(' ');
    if ( num2str(result)== num2str(test_true_lable(i))+1)
    count = count +1;
    end
end
suc = [suc count/samp_test];

end

plot(h,suc,'-')
legend('N(0, 1)', 'N = 1', 'N = 16', 'N = 256');

    title('Parzen窗法准确率');